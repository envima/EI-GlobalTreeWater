library(envimaR)
root_folder = path.expand("~/analysis/global_forest_cover/")
source(file.path(root_folder, "EI-GlobalForestAnalysis/src/000_setup.R"))
# Read datasets and aux data
er = readOGR(file.path(envrmt$path_ecoregions, "tnc_terr_ecoregions.shp"), layer = "tnc_terr_ecoregions")
map_files = list.files(envrmt$path_maped_datasets, pattern = glob2rx("tree_water*.tif"), full.names = TRUE)
map_files
map_files = list.files(envrmt$path_maped_datasets, pattern = glob2rx("tree_water*.tif"), full.names = TRUE)
maps = list("tree_water_mean",
"tree_water_mean_error",
"tree_water_mean_per_precipitation")
lables = list(expression("Mean tree water (m"^3*"/ha)"),
expression("Mean standard error (m"^3*"/ha)"),
expression("Mean tree water/annual precipitation"))
pallets = list(brewer.pal(9, "YlGnBu"), brewer.pal(9, "OrRd"), brewer.pal(9, "PuRd"))
prjt = st_crs(54012)
i = 1
act_data = raster(map_files[grep(paste0(maps[[i]], ".tif"), map_files)])
act_data
act_data = aggregate(act_data, factor = 10)
act_data = aggregate(act_data, factor = 10)
act_data = aggregate(act_data, factor = 10)
act_data = aggregate(act_data, factor = 10)
erp = spTransform(es, act_data)
# Read datasets and aux data
ecoreg = readOGR(file.path(envrmt$path_ecoregions, "tnc_terr_ecoregions.shp"), layer = "tnc_terr_ecoregions")
ecoreg = spTransform(ecoreg, act_data)
ecoreg_p = spTransform(ecoreg, projection(act_data))
act_extract = extract(act_data, ecoreg_p)
head(act_extract)
str(act_extract)
class(act_extract)
?extract
act_extract = extract(act_data, ecoreg_p, df=TRUE)
act_extract
head(act_extract)
nrow(act_extract)
act_data
act_extract = extract(act_data, ecoreg_p, df = FALSE)
head(act_extract)
names(act_extract)
ecoreg_p$WWF_MHTNAM
ecoreg_p
length(act_extract)
features(ecoreg_p)
length(ecoreg_p)
i = 1
ecoreg_p$WWF_MHTNAM[[i]]
head(ecoreg_p$WWF_MHTNAM)
data.frame(MHTNAM = ecoreg_p$WWF_MHTNAM[[i]],
VALUES = unlist(act_extract[[i]]))
act_eco_extr = lapply(seq(length(ecoreg_p)), function(i){
data.frame(MHTNAM = ecoreg_p$WWF_MHTNAM[[i]],
VALUES = unlist(act_extract[[i]]))
})
i
act_extract[[10]]
length(act_extract[[10]])
act_eco_extr = lapply(seq(length(ecoreg_p)), function(i){
if(length(act_extract[[i]]) > 0) {
return(data.frame(MHTNAM = ecoreg_p$WWF_MHTNAM[[i]],
VALUES = unlist(act_extract[[i]])))
} else {
return(data.frame(MHTNAM = ecoreg_p$WWF_MHTNAM[[i]],
VALUES = NA)
}
})
act_eco_extr = lapply(seq(length(ecoreg_p)), function(i){
if(length(act_extract[[i]]) > 0) {
return(data.frame(MHTNAM = ecoreg_p$WWF_MHTNAM[[i]],
VALUES = unlist(act_extract[[i]])))
} else {
return(data.frame(MHTNAM = ecoreg_p$WWF_MHTNAM[[i]],
VALUES = NA))
}
})
act_eco_extr = do.call("rbind", act_eco_extr)
head(act_eco_extr)
nrow(act_eco_extr)
act_data
length(act_eco_extr)
length(act_extract)
act_eco_extr = lapply(seq(length(ecoreg_p)), function(i){
if(length(act_extract[[i]]) > 0) {
return(data.frame(MHTNAM = ecoreg_p$WWF_MHTNAM[[i]],
VALUES = unlist(act_extract[[i]]),
COUNT = i))
} else {
return(data.frame(MHTNAM = ecoreg_p$WWF_MHTNAM[[i]],
VALUES = NA,
COUNT = i))
}
})
act_eco_extr = do.call("rbind", act_eco_extr)
nrow(act_eco_extr)
head(act_eco_extr)
head(act_eco_extr, 20)
plot(ecoreg_p)
names(act_eco_extr)
names(act_eco_extr)[2]
names(act_eco_extr)[2] = maps[[i]]
names(act_eco_extr)[2]
file.path(envrmt$path_graphics, "ecoregions_", maps[[i]], ".rds")
file.path(envrmt$path_graphics, paste0("ecoregions_", maps[[i]], ".rds"))
head(act_eco_extr)
names(act_eco_extr)[2] = "VALUES"
saveRDS(act_eco_extr = file.path(envrmt$path_graphics, paste0("ecoregions_", maps[[i]], ".rds")))
saveRDS(act_eco_extr, file = file.path(envrmt$path_graphics, paste0("ecoregions_", maps[[i]], ".rds")))
head(act_eco_extr)
libs = c("colorspace", "gdalUtils", "ggplot2" "mapview", "raster", "rgdal", "sp", "sf", "tmap")
envrmt = createEnvi(root_folder = root_folder, folders = project_folders,
path_prefix = "path_", libs = libs,
alt_env_id = "COMPUTERNAME", alt_env_value = "PCRZP",
alt_env_root_folder = "F:\\BEN\\edu")
libs = c("colorspace", "gdalUtils", "ggplot2", "mapview", "raster", "rgdal", "sp", "sf", "tmap")
envrmt = createEnvi(root_folder = root_folder, folders = project_folders,
path_prefix = "path_", libs = libs,
alt_env_id = "COMPUTERNAME", alt_env_value = "PCRZP",
alt_env_root_folder = "F:\\BEN\\edu")
ggplot(data = act_eco_extr, aes(x = MHTNAM, y = VALUES)) +
geom_boxplot()
ggplot(data = act_eco_extr, aes(x = MHTNAM, y = VALUES)) +
geom_boxplot() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
head(act_eco_extr)
ggplot(data = act_eco_extr, aes(x = MHTNAM, y = VALUES)) +
geom_boxplot() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
theme_light()
ggplot(data = act_eco_extr, aes(x = MHTNAM, y = VALUES)) +
geom_boxplot() +
theme_light() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(data = act_eco_extr, aes(x = MHTNAM, y = VALUES)) +
geom_boxplot() +
theme_light() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x=element_blank())
i
ggplot(data = act_eco_extr, aes(x = MHTNAM, y = VALUES)) +
geom_boxplot() +
theme_light() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank(),
axis.title.y = labels[[i]])
labels[[i]]
map_files = list.files(envrmt$path_maped_datasets, pattern = glob2rx("tree_water*.tif"), full.names = TRUE)
maps = list("tree_water_mean",
"tree_water_mean_error",
"tree_water_mean_per_precipitation")
lables = list(expression("Mean tree water (m"^3*"/ha)"),
expression("Mean standard error (m"^3*"/ha)"),
expression("Mean tree water/annual precipitation"))
pallets = list(brewer.pal(9, "YlGnBu"), brewer.pal(9, "OrRd"), brewer.pal(9, "PuRd"))
libs = c("colorspace", "gdalUtils", "ggplot2", "mapview", "raster", "RColorBrewer", "rgdal", "sp", "sf", "tmap")
envrmt = createEnvi(root_folder = root_folder, folders = project_folders,
path_prefix = "path_", libs = libs,
alt_env_id = "COMPUTERNAME", alt_env_value = "PCRZP",
alt_env_root_folder = "F:\\BEN\\edu")
pallets = list(brewer.pal(9, "YlGnBu"), brewer.pal(9, "OrRd"), brewer.pal(9, "PuRd"))
ggplot(data = act_eco_extr, aes(x = MHTNAM, y = VALUES)) +
geom_boxplot() +
theme_light() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank(),
axis.title.y = labels[[i]])
lables
labels[[i]]
ggplot(data = act_eco_extr, aes(x = MHTNAM, y = VALUES)) +
geom_boxplot() +
theme_light() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank(),
axis.title.y = lables[[i]])
ggplot(data = act_eco_extr, aes(x = MHTNAM, y = VALUES)) +
geom_boxplot() +
theme_light() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank()) +
labs(y = lables[[i]])
plt = ggplot(data = act_eco_extr, aes(x = MHTNAM, y = VALUES)) +
geom_boxplot() +
theme_light() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank()) +
labs(y = lables[[i]])
tiff(file.path(envrmt$path_graphics, paste0("plot_ecoregions_", maps[[i]], ".tif")), width = 3000, height = 3000, res = 300)
plt
dev.off()
plt = ggplot(data = act_eco_extr, aes(x = MHTNAM, y = VALUES)) +
geom_boxplot(notch = TRUE) +
theme_light() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank()) +
labs(y = lables[[i]])
plt
library(envimaR)
root_folder = path.expand("~/analysis/global_forest_cover/")
source(file.path(root_folder, "EI-GlobalForestAnalysis/src/000_setup.R"))
# Make pallets
# pal = choose_palette()
# saveRDS(pal, file = file.path(envrmt$path_graphics, "pal_mean_tree_water.rds"))
# saveRDS(pal, file = file.path(envrmt$path_graphics, "pal_tree_water_mean_error.rds"))
# Read datasets and aux data
ecoreg = readOGR(file.path(envrmt$path_ecoregions, "tnc_terr_ecoregions.shp"), layer = "tnc_terr_ecoregions")
map_files = list.files(envrmt$path_maped_datasets, pattern = glob2rx("tree_water*.tif"), full.names = TRUE)
maps = list("tree_water_mean",
"tree_water_mean_error",
"tree_water_mean_per_precipitation")
lables = list(expression("Mean tree water (m"^3*"/ha)"),
expression("Mean standard error (m"^3*"/ha)"),
expression("Mean tree water/annual precipitation"))
pallets = list(brewer.pal(9, "YlGnBu"), brewer.pal(9, "OrRd"), brewer.pal(9, "PuRd"))
for(i in seq(length(maps))){
act_data = raster(map_files[grep(paste0(maps[[i]], ".tif"), map_files)])
# act_data = aggregate(act_data, factor = 10)
# act_data = aggregate(act_data, factor = 10)
# act_data = aggregate(act_data, factor = 10)
# act_data = aggregate(act_data, factor = 10)
ecoreg_p = spTransform(ecoreg, projection(act_data))
act_extract = extract(act_data, ecoreg_p, df = FALSE)
act_eco_extr = lapply(seq(length(ecoreg_p)), function(j){
if(length(act_extract[[j]]) > 0) {
return(data.frame(MHTNAM = ecoreg_p$WWF_MHTNAM[[j]],
VALUES = unlist(act_extract[[j]]),
COUNT = j))
} else {
return(data.frame(MHTNAM = ecoreg_p$WWF_MHTNAM[[j]],
VALUES = NA,
COUNT = j))
}
})
act_eco_extr = do.call("rbind", act_eco_extr)
saveRDS(act_eco_extr, file = file.path(envrmt$path_graphics, paste0("ecoregions_", maps[[i]], ".rds")))
plt = ggplot(data = act_eco_extr, aes(x = MHTNAM, y = VALUES)) +
geom_boxplot() +
theme_light() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank()) +
labs(y = lables[[i]])
tiff(file.path(envrmt$path_graphics, paste0("plot_ecoregions_", maps[[i]], ".tif")), width = 3000, height = 3000, res = 300)
plt
dev.off()
}
root_folder = path.expand("~/analysis/global_forest_cover/")
root_folder
